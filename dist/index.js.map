{"version":3,"sources":["webpack://InfiniteScroll/webpack/universalModuleDefinition","webpack://InfiniteScroll/webpack/bootstrap","webpack://InfiniteScroll/./src/index.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","r","value","n","__esModule","object","property","prototype","hasOwnProperty","p","s","InfiniteScroll","constructor","options","this","fetch","render","viewPort","document","querySelector","viewPortHeight","offsetHeight","placeHolder","console","log","cacheItems","initialItems","loading","items","concat","prefetchData","map","data","node","top","height","setSentinel","anchorItem","index","offset","anchroScrollTop","start","end","style","position","addEventListener","onScroll","sentinel","transform","createElement","width","postion","willChange","appendChild","delta","scrollTop","lastScreenItem","calculateAnchoredItem","fill","anchor","curPos","curIdx","len","length","Math","max","viewContain","requestAnimationFrame","attachContent","[object Object]","item","unusedNodes","requestNum","showLoading","hideLoading","addItem","push","insertedNodes","fragment","createDocumentFragment","pop","append","removeChild","theFirstItem","theLastItem","idx","__webpack_exports__"],"mappings":"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","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"InfiniteScroll\"] = factory();\n\telse\n\t\troot[\"InfiniteScroll\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","export class InfiniteScroll {\n  /**\n   * @param {Object} options\n   * {el, fetch, render, placeHolder*, prefetchData*, cacheItems*, initialItems*}\n   */\n  constructor(options) {\n    const CACHE_ITEMS = 50\n    const INITIAL_ITEMS = 20\n\n    this.fetch = options.fetch\n    this.render = options.render\n    this.viewPort = document.querySelector('#app')\n    this.viewPortHeight = this.viewPort.offsetHeight\n    this.placeHolder = options.placeHolder || placeHolder\n\n    this.cacheItems = options.cacheItems || CACHE_ITEMS\n    this.initialItems = options.initialItems || INITIAL_ITEMS\n\n    this.loading = false\n    this.items = [].concat(options.prefetchData || [])\n    this.items = this.items.map(data => {\n      return {\n        data: data,\n        node: null,\n        top: 0,\n        height: 0\n      }\n    })\n    this.setSentinel()\n    this.anchorItem = { index: 0, offset: 0 }\n    this.anchroScrollTop = 0\n    this.start = 0\n    this.end = 0\n\n    this.viewPort.style.position = 'relative'\n    this.viewPort.addEventListener('scroll', () => {\n      this.onScroll()\n    })\n    this.onScroll()\n\n    function placeHolder() {\n      console.log('placeHolder')\n    }\n  }\n\n  setSentinel(top) {\n    if (this.sentinel) {\n      return this.sentinel.style.transform = `translateY(${top - 1}px)`\n    }\n\n    let sentinel = document.createElement('div')\n    sentinel.style.width = '1px'\n    sentinel.style.height = '1px'\n    sentinel.style.postion = 'absolute'\n    sentinel.style.willChange = 'transform'\n    sentinel.style.transform = `translateY(0)`\n    this.sentinel = sentinel\n    this.viewPort.appendChild(sentinel)\n  }\n\n  onScroll() {\n    const delta = this.viewPort.scrollTop - this.anchroScrollTop\n    this.anchroScrollTop = this.viewPort.scrollTop\n\n    let lastScreenItem\n    if (delta !== 0) {\n      this.anchorItem = this.calculateAnchoredItem(this.anchorItem, delta)\n      lastScreenItem = this.calculateAnchoredItem(this.anchorItem, this.viewPortHeight)\n    } else {\n      lastScreenItem = { index: this.initialItems }\n    }\n    this.fill(this.anchorItem.index - this.cacheItems, lastScreenItem.index + this.cacheItems)\n  }\n\n  calculateAnchoredItem(anchor, delta) {\n    let curIdx = anchor.index\n    let anchorItem = this.items[curIdx]\n    let curPos\n    let index\n    let offset\n\n    let len = this.items.length - 1\n    if (delta > 0) {\n      curPos = delta - (anchorItem.height - anchor.offset)\n      curIdx++\n\n      while (curPos > 0 && curIdx < len) {\n        curPos = curPos - this.items[curIdx++].height\n      }\n\n      index = curIdx - 1\n      offset = this.items[curIdx - 1].height + curPos\n    } else {\n      delta = -1 * delta\n      curPos = delta - anchor.offset\n      curIdx--\n\n      while (curPos > 0 && curIdx >= 0) {\n        curPos = curPos - this.items[curIdx--].height\n      }\n\n      index = curIdx + 1\n      offset = -1 * curPos\n    }\n\n    return { index, offset }\n  }\n\n  fill(start, end) {\n    start = Math.max(0, start)\n\n    if (this.viewContain(start, end)) return\n\n    if (window.requestAnimationFrame) {\n      requestAnimationFrame(() => {\n        this.attachContent(start, end)\n      })\n    } else {\n      // issue: may cause white screen when scrolling\n      this.attachContent(start, end)\n    }\n  }\n\n  viewContain(start, end) {\n    return start >= this.start && end <= this.end\n  }\n\n  async attachContent(start, end) {\n    let data = []\n    let unusedNodes = []\n    let requestNum = Math.max(this.cacheItems, end - this.end)\n\n    if (end > this.end) {\n      if (end > this.items.length) {\n        if (this.loading) return\n\n        this.loading = true\n        this.showLoading()\n        data = await this.fetch(requestNum)\n        this.hideLoading()\n        this.loading = false\n\n        for (let d of data) {\n          this.addItem(d)\n        }\n      }\n\n      let node\n      for (let i = this.start; i < start; i++) {\n        node = this.items[i].node\n        if (node) {\n          unusedNodes.push(node)\n          this.items[i].node = null\n        }\n      }\n\n      this.start = start\n      data.length ? this.end += data.length : this.end = end\n    } else if (start < this.start) {\n      let node\n      for (let i = end; i < this.end; i++) {\n        node = this.items[i].node\n        if (node) {\n          unusedNodes.push(node)\n          this.items[i].node = null\n        }\n      }\n\n      this.start = start\n      this.end = end\n    }\n\n    let item\n    let insertedNodes = []\n    let fragment = document.createDocumentFragment()\n    for (let i = this.start; i < this.end; i++) {\n      item = this.items[i]\n      if (!item.node) {\n        item.node = this.render(item.data, unusedNodes.pop())\n        item.node.style.willChange = 'transform'\n        fragment.append(item.node)\n        insertedNodes.push(i)\n      }\n    }\n    this.viewPort.appendChild(fragment)\n\n    while (unusedNodes.length) {\n      this.viewPort.removeChild(unusedNodes.pop())\n    }\n\n    let theFirstItem = this.items[0]\n    if (!theFirstItem.height) {\n      theFirstItem.top = 0\n      theFirstItem.height = item.node.offsetHeight\n    }\n    for (let i = Math.max(1, this.start); i < this.end; i++) {\n      item = this.items[i]\n      if (!item.top) {\n        item.top = this.items[i - 1].top + this.items[i - 1].height\n        item.height = item.node.offsetHeight\n      }\n    }\n\n    let theLastItem = this.items[this.items.length - 1]\n    this.setSentinel(theLastItem.top + theLastItem.height)\n\n    for (let idx of insertedNodes) {\n      item = this.items[idx]\n      item.node.style.position = 'absolute'\n      item.node.style.transform = `translateY(${item.top}px)`\n    }\n  }\n\n  addItem(data) {\n    this.items.push({\n      data: data,\n      node: null,\n      top: 0,\n      height: 0\n    })\n  }\n\n  showLoading() {\n    console.log('loading start')\n  }\n\n  hideLoading() {\n    console.log('loading end')\n  }\n}\n\nexport default { InfiniteScroll }\n\n"],"sourceRoot":""}