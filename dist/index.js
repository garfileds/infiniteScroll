!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.InfiniteScroll=e():t.InfiniteScroll=e()}(window,function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/",i(i.s=0)}([function(t,e,i){"use strict";i.r(e),i.d(e,"InfiniteScroll",function(){return s});class s{constructor(t){this.fetch=t.fetch,this.render=t.render,this.viewPort=document.querySelector("#app"),this.viewPortHeight=this.viewPort.offsetHeight,this.placeHolder=t.placeHolder||function(){console.log("placeHolder")},this.cacheItems=t.cacheItems||50,this.initialItems=t.initialItems||20,this.loading=!1,this.items=[].concat(t.prefetchData||[]),this.items=this.items.map(t=>({data:t,node:null,top:0,height:0})),this.setSentinel(),this.anchorItem={index:0,offset:0},this.anchroScrollTop=0,this.start=0,this.end=0,this.viewPort.style.position="relative",this.viewPort.addEventListener("scroll",()=>{this.onScroll()}),this.onScroll()}setSentinel(t){if(this.sentinel)return this.sentinel.style.transform=`translateY(${t-1}px)`;let e=document.createElement("div");e.style.width="1px",e.style.height="1px",e.style.postion="absolute",e.style.willChange="transform",e.style.transform="translateY(0)",this.sentinel=e,this.viewPort.appendChild(e)}onScroll(){const t=this.viewPort.scrollTop-this.anchroScrollTop;let e;this.anchroScrollTop=this.viewPort.scrollTop,0!==t?(this.anchorItem=this.calculateAnchoredItem(this.anchorItem,t),e=this.calculateAnchoredItem(this.anchorItem,this.viewPortHeight)):e={index:this.initialItems},this.fill(this.anchorItem.index-this.cacheItems,e.index+this.cacheItems)}calculateAnchoredItem(t,e){let i,s,n,o=t.index,h=this.items[o],r=this.items.length-1;if(e>0){for(i=e-(h.height-t.offset),o++;i>0&&o<r;)i-=this.items[o++].height;s=o-1,n=this.items[o-1].height+i}else{for(i=(e*=-1)-t.offset,o--;i>0&&o>=0;)i-=this.items[o--].height;s=o+1,n=-1*i}return{index:s,offset:n}}fill(t,e){t=Math.max(0,t),this.viewContain(t,e)||(window.requestAnimationFrame?requestAnimationFrame(()=>{this.attachContent(t,e)}):this.attachContent(t,e))}viewContain(t,e){return t>=this.start&&e<=this.end}async attachContent(t,e){let i,s=[],n=[],o=Math.max(this.cacheItems,e-this.end);if(e>this.end){if(e>this.items.length){if(this.loading)return;this.loading=!0,this.showLoading(),s=await this.fetch(o),this.hideLoading(),this.loading=!1;for(let t of s)this.addItem(t)}let i;for(let e=this.start;e<t;e++)(i=this.items[e].node)&&(n.push(i),this.items[e].node=null);this.start=t,s.length?this.end+=s.length:this.end=e}else if(t<this.start){let i;for(let t=e;t<this.end;t++)(i=this.items[t].node)&&(n.push(i),this.items[t].node=null);this.start=t,this.end=e}let h=[],r=document.createDocumentFragment();for(let t=this.start;t<this.end;t++)(i=this.items[t]).node||(i.node=this.render(i.data,n.pop()),i.node.style.willChange="transform",r.append(i.node),h.push(t));for(this.viewPort.appendChild(r);n.length;)this.viewPort.removeChild(n.pop());let l=this.items[0];l.height||(l.top=0,l.height=i.node.offsetHeight);for(let t=Math.max(1,this.start);t<this.end;t++)(i=this.items[t]).top||(i.top=this.items[t-1].top+this.items[t-1].height,i.height=i.node.offsetHeight);let a=this.items[this.items.length-1];this.setSentinel(a.top+a.height);for(let t of h)(i=this.items[t]).node.style.position="absolute",i.node.style.transform=`translateY(${i.top}px)`}addItem(t){this.items.push({data:t,node:null,top:0,height:0})}showLoading(){console.log("loading start")}hideLoading(){console.log("loading end")}}e.default={InfiniteScroll:s}}])});
//# sourceMappingURL=index.js.map